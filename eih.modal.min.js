(function(n,t,i,r){var h="modal",a={width:"auto",height:"auto",css:{},stayInWindow:!0,putItBack:!0,url:"",content:"",type:"default",onOpen:function(){},onClose:function(){},onLoad:function(){},intoFrame:!1,frameOptions:{frameBorder:"0",scrolling:"no"}},o=function(t,i){var u=this;arguments.length===1&&(i=t,t=r);t&&(u.element=t,u.$element=n(t),u.$parent=u.$element.parent());u.options=n.extend(!0,{},a,i);u._defaults=a;u._name=h;u.init()},v=i.body,s,u,f,c,e=n(t),l=n(i);n.data(t,"plugin_"+h)||(n.data(t,"plugin_"+h,!0),s=n("<div />",{"class":"modal-bg closed"}).appendTo(v).css({width:e.width(),height:l.height()}),u=n("<div />",{"class":"modal-container closed"}).appendTo(v),f=n("<div />",{"class":"modal-content"}).appendTo(u),c=n("<div />",{"class":"modal-close"}).appendTo(u));o.prototype.init=function(){var i=this,t=i.options,o=i.$element||null,h,r;if(u.removeAttr("style"),o&&(i.visibleState=o.is(":visible"),i.elemIndex=o.index()),u.hasClass("closed")||n.modalize.close(!0),t.type==="image")t.putItBack=!1,h=t.url,f.addClass("loading"),n("<img />",{src:h,width:t.width,height:t.height}).one("load.modalize",function(){var u=n(this),h=u.width(),s=u.height(),a=h/s,c=e.width(),l=e.height(),o,r;t.onLoad.call(i);f.removeClass("loading");s>l&&(o=l-100,r=o*a,h=r,s=o,r>c&&(r=c-100,o=s*(r/h)),u.width(r),u.height(o));u.show();i.reposition()}).appendTo(f).hide();else if(t.type==="text")t.putItBack=!1,f.html(t.content),u.height(t.height),u.width(t.width);else if(t.type==="default")if(f.addClass("loading"),t.url)if(t.intoFrame){t.frameOptions.src=t.url;n.extend(t.frameOptions,{src:t.url,width:t.width+"px",height:t.height+"px"});r=n("<iframe />",t.frameOptions);r.on("load.modalize",function(n,u,e){t.onLoad.call(i,this,n,u,e);f.removeClass("loading");r.show();i.reposition()});f.html(r.hide())}else t.putItBack=!1,n.get(t.url,function(n,r,e){f.html(n);u.height(t.height);u.width(t.width);f.removeClass("loading");i.reposition();t.onLoad.call(i,n,status,e)});else f.removeClass("loading"),f.html(i.$element.show());u.css(t.css);l.one("keyup.modalize",function(n){n.keyCode==27&&i.close()});e.off(".modalize");e.on("resize.modalize",function(){i.reposition()});s.one("click.modalize",function(){i.close()});c.one("click.modalize",function(){i.close()});i.show();n.modalize.close=function(n){i.close.call(i,n)}};o.prototype.reposition=function(){var r=this,f=r.options,o=u.width(),n=u.height(),t=o/-2,h=n/-2,a=e.width(),i=e.height(),c=f.stayInWindow;s.css({width:e.width(),height:l.height()});c?u.css({position:"fixed","margin-left":t+"px","margin-top":h+"px",top:"50%",left:"50%"}):u.css({position:"absolute","margin-left":t+"px","margin-top":0,top:(n+40>i?e.scrollTop()+40:e.scrollTop()+(i-n)/2)+"px"})};o.prototype.close=function(t){var i=this,r=i.options;i.detach();t||(s.addClass("closed"),u.addClass("closed"),r.onClose.call(i),e.off(".modalize"),s.off(".modalize"),c.off(".modalize"));delete n.modalize.close};o.prototype.detach=function(){var n=this,t=n.options;n.$element&&(t.putItBack&&(n.elemIndex===0?n.$parent.prepend(n.$element):n.$parent.children().eq(n.elemIndex-1).after(n.$element)),n.visibleState?n.$element.show():n.$element.hide());f.empty()};o.prototype.show=function(){var n=this,t=n.options;s.removeClass("closed");u.removeClass("closed");n.reposition();t.onOpen.call(n)};n.fn.modalize=function(n){return this.each(function(){new o(this,n)})};n.modalize=function(n){new o(n)}})(jQuery,window,document);